name: Update Twitch Playlist

on:
  schedule:
    - cron: '0 */3 * * *'  # هر 3 ساعت یک‌بار
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install streamlink
        run: |
          sudo apt update
          sudo apt install -y streamlink

      - name: Get m3u8 link for ManotoArchive
        id: get_m3u8
        run: |
          M3U8_URL=$(streamlink --stream-url https://www.twitch.tv/ManotoArchive best)
          echo "M3U8_URL=$M3U8_URL" >> $GITHUB_ENV

      - name: Update playlist.m3u
        run: |
          echo "#EXTM3U" > playlist.m3u
          echo "#EXTINF:-1,ManotoArchive" >> playlist.m3u
          echo "$M3U8_URL" >> playlist.m3u
          
      - name: Commit and push changes
        run: |
          git config --global user.email "heshmati.rz@gmail.com"
          git config --global user.name "RezaHeshmati30"
          git add playlist.m3u
          git commit -m "Update Twitch m3u8 link"
          git push
